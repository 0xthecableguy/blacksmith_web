(function(N,x){typeof exports=="object"&&typeof module<"u"?module.exports=x():typeof define=="function"&&define.amd?define(x):(N=typeof globalThis<"u"?globalThis:N||self,N.BlacksmithLabChatUI=x())})(this,function(){"use strict";var Ma=Object.defineProperty;var ns=N=>{throw TypeError(N)};var Da=(N,x,V)=>x in N?Ma(N,x,{enumerable:!0,configurable:!0,writable:!0,value:V}):N[x]=V;var J=(N,x,V)=>Da(N,typeof x!="symbol"?x+"":x,V),rs=(N,x,V)=>x.has(N)||ns("Cannot "+V);var ht=(N,x,V)=>(rs(N,x,"read from private field"),V?V.call(N):x.get(N)),_r=(N,x,V)=>x.has(N)?ns("Cannot add the same private member more than once"):x instanceof WeakSet?x.add(N):x.set(N,V),gr=(N,x,V,Xe)=>(rs(N,x,"write to private field"),Xe?Xe.call(N,V):x.set(N,V),V);var Ut,bt;const N="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(N);let x=!1,V=!1;function Xe(){x=!0}Xe();const is=1,ss=2,os=16,as=2,ls=8,us=1,cs=2,br="[",On="[!",Nn="]",ie={},at=Symbol(),yr=!1,yt=2,Er=4,Ke=8,Ln=16,Dt=32,se=64,Je=128,vt=256,Ze=512,Q=1024,Ot=2048,oe=4096,Nt=8192,Qe=16384,fs=32768,$n=65536,hs=1<<17,ds=1<<19,Tr=1<<20,Jt=Symbol("$state"),wr=Symbol("legacy props"),ps=Symbol("");var Pn=Array.isArray,ms=Array.prototype.indexOf,In=Array.from,tn=Object.keys,Te=Object.defineProperty,zt=Object.getOwnPropertyDescriptor,Sr=Object.getOwnPropertyDescriptors,vs=Object.prototype,_s=Array.prototype,Un=Object.getPrototypeOf;const ae=()=>{};function gs(e){return e()}function en(e){for(var t=0;t<e.length;t++)e[t]()}const bs=typeof requestIdleCallback>"u"?e=>setTimeout(e,1):requestIdleCallback;let we=[],Se=[];function Ar(){var e=we;we=[],en(e)}function Cr(){var e=Se;Se=[],en(e)}function Rr(e){we.length===0&&queueMicrotask(Ar),we.push(e)}function ys(e){Se.length===0&&bs(Cr),Se.push(e)}function xr(){we.length>0&&Ar(),Se.length>0&&Cr()}function kr(e){return e===this.v}function Fn(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function Wn(e){return!Fn(e,this.v)}function Es(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ts(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function ws(e){throw new Error("https://svelte.dev/e/effect_orphan")}function Ss(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function As(){throw new Error("https://svelte.dev/e/hydration_failed")}function Cs(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function Rs(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function xs(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function ks(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function Ms(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function _t(e,t){var n={f:0,v:e,reactions:null,equals:kr,rv:0,wv:0};return n}function Ae(e,t=!1){var r;const n=_t(e);return t||(n.equals=Wn),x&&F!==null&&F.l!==null&&((r=F.l).s??(r.s=[])).push(n),n}function Ce(e,t=!1){return Ds(Ae(e,t))}function Ds(e){return O!==null&&!Tt&&(O.f&yt)!==0&&(Ct===null?Ls([e]):Ct.push(e)),e}function G(e,t){return O!==null&&!Tt&&De()&&(O.f&(yt|Ln))!==0&&(Ct===null||!Ct.includes(e))&&Ms(),Mr(e,t)}function Mr(e,t){return e.equals(t)||(e.v,e.v=t,e.wv=Gr(),Dr(e,Ot),De()&&M!==null&&(M.f&Q)!==0&&(M.f&(Dt|se))===0&&(Pt===null?$s([e]):Pt.push(e))),t}function Dr(e,t){var n=e.reactions;if(n!==null)for(var r=De(),i=n.length,s=0;s<i;s++){var o=n[s],l=o.f;(l&Ot)===0&&(!r&&o===M||(Rt(o,t),(l&(Q|vt))!==0&&((l&yt)!==0?Dr(o,oe):hn(o))))}}function nn(e){var t=yt|Ot,n=O!==null&&(O.f&yt)!==0?O:null;return M===null||n!==null&&(n.f&vt)!==0?t|=vt:M.f|=Tr,{ctx:F,deps:null,effects:null,equals:kr,f:t,fn:e,reactions:null,rv:0,v:null,wv:0,parent:n??M}}function Or(e){const t=nn(e);return t.equals=Wn,t}function Nr(e){var t=e.effects;if(t!==null){e.effects=null;for(var n=0;n<t.length;n+=1)xt(t[n])}}function Os(e){for(var t=e.parent;t!==null;){if((t.f&yt)===0)return t;t=t.parent}return null}function Ns(e){var t,n=M;qt(Os(e));try{Nr(e),t=qr(e)}finally{qt(n)}return t}function Lr(e){var t=Ns(e),n=(Yt||(e.f&vt)!==0)&&e.deps!==null?oe:Q;Rt(e,n),e.equals(t)||(e.v=t,e.wv=Gr())}function rn(e){console.warn("https://svelte.dev/e/hydration_mismatch")}let k=!1;function Lt(e){k=e}let L;function Et(e){if(e===null)throw rn(),ie;return L=e}function le(){return Et($t(L))}function tt(e){if(k){if($t(L)!==null)throw rn(),ie;L=e}}function Hn(){for(var e=0,t=L;;){if(t.nodeType===8){var n=t.data;if(n===Nn){if(e===0)return t;e-=1}else(n===br||n===On)&&(e+=1)}var r=$t(t);t.remove(),t=r}}function ue(e,t=null,n){if(typeof e!="object"||e===null||Jt in e)return e;const r=Un(e);if(r!==vs&&r!==_s)return e;var i=new Map,s=Pn(e),o=_t(0);s&&i.set("length",_t(e.length));var l;return new Proxy(e,{defineProperty(c,u,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&Rs();var d=i.get(u);return d===void 0?(d=_t(f.value),i.set(u,d)):G(d,ue(f.value,l)),!0},deleteProperty(c,u){var f=i.get(u);if(f===void 0)u in c&&i.set(u,_t(at));else{if(s&&typeof u=="string"){var d=i.get("length"),h=Number(u);Number.isInteger(h)&&h<d.v&&G(d,h)}G(f,at),$r(o)}return!0},get(c,u,f){var m;if(u===Jt)return e;var d=i.get(u),h=u in c;if(d===void 0&&(!h||(m=zt(c,u))!=null&&m.writable)&&(d=_t(ue(h?c[u]:at,l)),i.set(u,d)),d!==void 0){var p=S(d);return p===at?void 0:p}return Reflect.get(c,u,f)},getOwnPropertyDescriptor(c,u){var f=Reflect.getOwnPropertyDescriptor(c,u);if(f&&"value"in f){var d=i.get(u);d&&(f.value=S(d))}else if(f===void 0){var h=i.get(u),p=h==null?void 0:h.v;if(h!==void 0&&p!==at)return{enumerable:!0,configurable:!0,value:p,writable:!0}}return f},has(c,u){var p;if(u===Jt)return!0;var f=i.get(u),d=f!==void 0&&f.v!==at||Reflect.has(c,u);if(f!==void 0||M!==null&&(!d||(p=zt(c,u))!=null&&p.writable)){f===void 0&&(f=_t(d?ue(c[u],l):at),i.set(u,f));var h=S(f);if(h===at)return!1}return d},set(c,u,f,d){var R;var h=i.get(u),p=u in c;if(s&&u==="length")for(var m=f;m<h.v;m+=1){var C=i.get(m+"");C!==void 0?G(C,at):m in c&&(C=_t(at),i.set(m+"",C))}h===void 0?(!p||(R=zt(c,u))!=null&&R.writable)&&(h=_t(void 0),G(h,ue(f,l)),i.set(u,h)):(p=h.v!==at,G(h,ue(f,l)));var T=Reflect.getOwnPropertyDescriptor(c,u);if(T!=null&&T.set&&T.set.call(d,f),!p){if(s&&typeof u=="string"){var b=i.get("length"),E=Number(u);Number.isInteger(E)&&E>=b.v&&G(b,E+1)}$r(o)}return!0},ownKeys(c){S(o);var u=Reflect.ownKeys(c).filter(h=>{var p=i.get(h);return p===void 0||p.v!==at});for(var[f,d]of i)d.v!==at&&!(f in c)&&u.push(f);return u},setPrototypeOf(){xs()}})}function $r(e,t=1){G(e,e.v+t)}var Pr,Ir,Ur,Fr;function Bn(){if(Pr===void 0){Pr=window,Ir=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype;Ur=zt(t,"firstChild").get,Fr=zt(t,"nextSibling").get,e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__styles=null,e.__e=void 0,Text.prototype.__t=void 0}}function Re(e=""){return document.createTextNode(e)}function Gt(e){return Ur.call(e)}function $t(e){return Fr.call(e)}function lt(e,t){if(!k)return Gt(e);var n=Gt(L);return n===null&&(n=L.appendChild(Re())),Et(n),n}function Wr(e,t){if(!k){var n=Gt(e);return n instanceof Comment&&n.data===""?$t(n):n}return L}function At(e,t=1,n=!1){let r=k?L:e;for(var i;t--;)i=r,r=$t(r);if(!k)return r;var s=r==null?void 0:r.nodeType;if(n&&s!==3){var o=Re();return r===null?i==null||i.after(o):r.before(o),Et(o),o}return Et(r),r}function Hr(e){e.textContent=""}let sn=!1,on=!1,an=null,ln=!1,zn=!1;function Br(e){zn=e}let xe=[],Oa=[],O=null,Tt=!1;function jt(e){O=e}let M=null;function qt(e){M=e}let Ct=null;function Ls(e){Ct=e}let et=null,dt=0,Pt=null;function $s(e){Pt=e}let zr=1,un=0,Yt=!1;function Gr(){return++zr}function ke(e){var d;var t=e.f;if((t&Ot)!==0)return!0;if((t&oe)!==0){var n=e.deps,r=(t&vt)!==0;if(n!==null){var i,s,o=(t&Ze)!==0,l=r&&M!==null&&!Yt,c=n.length;if(o||l){var u=e,f=u.parent;for(i=0;i<c;i++)s=n[i],(o||!((d=s==null?void 0:s.reactions)!=null&&d.includes(u)))&&(s.reactions??(s.reactions=[])).push(u);o&&(u.f^=Ze),l&&f!==null&&(f.f&vt)===0&&(u.f^=vt)}for(i=0;i<c;i++)if(s=n[i],ke(s)&&Lr(s),s.wv>e.wv)return!0}(!r||M!==null&&!Yt)&&Rt(e,Q)}return!1}function Ps(e,t){for(var n=t;n!==null;){if((n.f&Je)!==0)try{n.fn(e);return}catch{n.f^=Je}n=n.parent}throw sn=!1,e}function Is(e){return(e.f&Qe)===0&&(e.parent===null||(e.parent.f&Je)===0)}function cn(e,t,n,r){if(sn){if(n===null&&(sn=!1),Is(t))throw e;return}n!==null&&(sn=!0);{Ps(e,t);return}}function jr(e,t,n=!0){var r=e.reactions;if(r!==null)for(var i=0;i<r.length;i++){var s=r[i];(s.f&yt)!==0?jr(s,t,!1):t===s&&(n?Rt(s,Ot):(s.f&Q)!==0&&Rt(s,oe),hn(s))}}function qr(e){var p;var t=et,n=dt,r=Pt,i=O,s=Yt,o=Ct,l=F,c=Tt,u=e.f;et=null,dt=0,Pt=null,Yt=(u&vt)!==0&&(Tt||!ln||O===null),O=(u&(Dt|se))===0?e:null,Ct=null,ni(e.ctx),Tt=!1,un++;try{var f=(0,e.fn)(),d=e.deps;if(et!==null){var h;if(fn(e,dt),d!==null&&dt>0)for(d.length=dt+et.length,h=0;h<et.length;h++)d[dt+h]=et[h];else e.deps=d=et;if(!Yt)for(h=dt;h<d.length;h++)((p=d[h]).reactions??(p.reactions=[])).push(e)}else d!==null&&dt<d.length&&(fn(e,dt),d.length=dt);if(De()&&Pt!==null&&!Tt&&d!==null&&(e.f&(yt|oe|Ot))===0)for(h=0;h<Pt.length;h++)jr(Pt[h],e);return i!==null&&un++,f}finally{et=t,dt=n,Pt=r,O=i,Yt=s,Ct=o,ni(l),Tt=c}}function Us(e,t){let n=t.reactions;if(n!==null){var r=ms.call(n,e);if(r!==-1){var i=n.length-1;i===0?n=t.reactions=null:(n[r]=n[i],n.pop())}}n===null&&(t.f&yt)!==0&&(et===null||!et.includes(t))&&(Rt(t,oe),(t.f&(vt|Ze))===0&&(t.f^=Ze),Nr(t),fn(t,0))}function fn(e,t){var n=e.deps;if(n!==null)for(var r=t;r<n.length;r++)Us(e,n[r])}function Gn(e){var t=e.f;if((t&Qe)===0){Rt(e,Q);var n=M,r=F,i=ln;M=e,ln=!0;try{(t&Ln)!==0?Ys(e):Zr(e),Jr(e);var s=qr(e);e.teardown=typeof s=="function"?s:null,e.wv=zr;var o=e.deps,l;yr&&V&&e.f&Ot}catch(c){cn(c,e,n,r||e.ctx)}finally{ln=i,M=n}}}function Fs(){try{Ss()}catch(e){if(an!==null)cn(e,an,null);else throw e}}function Yr(){try{for(var e=0;xe.length>0;){e++>1e3&&Fs();var t=xe,n=t.length;xe=[];for(var r=0;r<n;r++){var i=t[r];(i.f&Q)===0&&(i.f^=Q);var s=Hs(i);Ws(s)}}}finally{on=!1,an=null}}function Ws(e){var t=e.length;if(t!==0)for(var n=0;n<t;n++){var r=e[n];if((r.f&(Qe|Nt))===0)try{ke(r)&&(Gn(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null?Qr(r):r.fn=null))}catch(i){cn(i,r,null,r.ctx)}}}function hn(e){on||(on=!0,queueMicrotask(Yr));for(var t=an=e;t.parent!==null;){t=t.parent;var n=t.f;if((n&(se|Dt))!==0){if((n&Q)===0)return;t.f^=Q}}xe.push(t)}function Hs(e){for(var t=[],n=e.first;n!==null;){var r=n.f,i=(r&Dt)!==0,s=i&&(r&Q)!==0;if(!s&&(r&Nt)===0){if((r&Er)!==0)t.push(n);else if(i)n.f^=Q;else{var o=O;try{O=n,ke(n)&&Gn(n)}catch(u){cn(u,n,null,n.ctx)}finally{O=o}}var l=n.first;if(l!==null){n=l;continue}}var c=n.parent;for(n=n.next;n===null&&c!==null;)n=c.next,c=c.parent}return t}function dn(e){var t;for(xr();xe.length>0;)on=!0,Yr(),xr();return t}async function Vr(){await Promise.resolve(),dn()}function S(e){var t=e.f,n=(t&yt)!==0;if(O!==null&&!Tt){Ct!==null&&Ct.includes(e)&&ks();var r=O.deps;e.rv<un&&(e.rv=un,et===null&&r!==null&&r[dt]===e?dt++:et===null?et=[e]:(!Yt||!et.includes(e))&&et.push(e))}else if(n&&e.deps===null&&e.effects===null){var i=e,s=i.parent;s!==null&&(s.f&vt)===0&&(i.f^=vt)}return n&&(i=e,ke(i)&&Lr(i)),e.v}function Zt(e){var t=Tt;try{return Tt=!0,e()}finally{Tt=t}}const Bs=-7169;function Rt(e,t){e.f=e.f&Bs|t}function Xr(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(Jt in e)jn(e);else if(!Array.isArray(e))for(let t in e){const n=e[t];typeof n=="object"&&n&&Jt in n&&jn(n)}}}function jn(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let r in e)try{jn(e[r],t)}catch{}const n=Un(e);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=Sr(n);for(let i in r){const s=r[i].get;if(s)try{s.call(e)}catch{}}}}}function Kr(e){M===null&&O===null&&ws(),O!==null&&(O.f&vt)!==0&&M===null&&Ts(),zn&&Es()}function zs(e,t){var n=t.last;n===null?t.last=t.first=e:(n.next=e,e.prev=n,t.last=e)}function Qt(e,t,n,r=!0){var i=(e&se)!==0,s=M,o={ctx:F,deps:null,nodes_start:null,nodes_end:null,f:e|Ot,first:null,fn:t,last:null,next:null,parent:i?null:s,prev:null,teardown:null,transitions:null,wv:0};if(n)try{Gn(o),o.f|=fs}catch(u){throw xt(o),u}else t!==null&&hn(o);var l=n&&o.deps===null&&o.first===null&&o.nodes_start===null&&o.teardown===null&&(o.f&(Tr|Je))===0;if(!l&&!i&&r&&(s!==null&&zs(o,s),O!==null&&(O.f&yt)!==0)){var c=O;(c.effects??(c.effects=[])).push(o)}return o}function qn(e){const t=Qt(Ke,null,!1);return Rt(t,Q),t.teardown=e,t}function Yn(e){Kr();var t=M!==null&&(M.f&Dt)!==0&&F!==null&&!F.m;if(t){var n=F;(n.e??(n.e=[])).push({fn:e,effect:M,reaction:O})}else{var r=pn(e);return r}}function Gs(e){return Kr(),Me(e)}function js(e){const t=Qt(se,e,!0);return()=>{xt(t)}}function qs(e){const t=Qt(se,e,!0);return(n={})=>new Promise(r=>{n.outro?vn(t,()=>{xt(t),r(void 0)}):(xt(t),r(void 0))})}function pn(e){return Qt(Er,e,!1)}function Me(e){return Qt(Ke,e,!0)}function Vn(e,t=[],n=nn){const r=t.map(n);return mn(()=>e(...r.map(S)))}function mn(e,t=0){return Qt(Ke|Ln|t,e,!0)}function ce(e,t=!0){return Qt(Ke|Dt,e,!0,t)}function Jr(e){var t=e.teardown;if(t!==null){const n=zn,r=O;Br(!0),jt(null);try{t.call(null)}finally{Br(n),jt(r)}}}function Zr(e,t=!1){var n=e.first;for(e.first=e.last=null;n!==null;){var r=n.next;xt(n,t),n=r}}function Ys(e){for(var t=e.first;t!==null;){var n=t.next;(t.f&Dt)===0&&xt(t),t=n}}function xt(e,t=!0){var n=!1;if((t||(e.f&ds)!==0)&&e.nodes_start!==null){for(var r=e.nodes_start,i=e.nodes_end;r!==null;){var s=r===i?null:$t(r);r.remove(),r=s}n=!0}Zr(e,t&&!n),fn(e,0),Rt(e,Qe);var o=e.transitions;if(o!==null)for(const c of o)c.stop();Jr(e);var l=e.parent;l!==null&&l.first!==null&&Qr(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=null}function Qr(e){var t=e.parent,n=e.prev,r=e.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),t!==null&&(t.first===e&&(t.first=r),t.last===e&&(t.last=n))}function vn(e,t){var n=[];Xn(e,n,!0),ti(n,()=>{xt(e),t&&t()})}function ti(e,t){var n=e.length;if(n>0){var r=()=>--n||t();for(var i of e)i.out(r)}else t()}function Xn(e,t,n){if((e.f&Nt)===0){if(e.f^=Nt,e.transitions!==null)for(const o of e.transitions)(o.is_global||n)&&t.push(o);for(var r=e.first;r!==null;){var i=r.next,s=(r.f&$n)!==0||(r.f&Dt)!==0;Xn(r,t,s?n:!1),r=i}}}function _n(e){ei(e,!0)}function ei(e,t){if((e.f&Nt)!==0){e.f^=Nt,(e.f&Q)===0&&(e.f^=Q),ke(e)&&(Rt(e,Ot),hn(e));for(var n=e.first;n!==null;){var r=n.next,i=(n.f&$n)!==0||(n.f&Dt)!==0;ei(n,i?t:!1),n=r}if(e.transitions!==null)for(const s of e.transitions)(s.is_global||t)&&s.in()}}function Vs(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let F=null;function ni(e){F=e}function ri(e,t=!1,n){F={p:F,c:null,e:null,m:!1,s:e,x:null,l:null},x&&!t&&(F.l={s:null,u:null,r1:[],r2:_t(!1)})}function ii(e){const t=F;if(t!==null){e!==void 0&&(t.x=e);const o=t.e;if(o!==null){var n=M,r=O;t.e=null;try{for(var i=0;i<o.length;i++){var s=o[i];qt(s.effect),jt(s.reaction),pn(s.fn)}}finally{qt(n),jt(r)}}F=t.p,t.m=!0}return e||{}}function De(){return!x||F!==null&&F.l===null}const Xs=["touchstart","touchmove"];function Ks(e){return Xs.includes(e)}let si=!1;function oi(){si||(si=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{var t;if(!e.defaultPrevented)for(const n of e.target.elements)(t=n.__on_r)==null||t.call(n)})},{capture:!0}))}function ai(e){var t=O,n=M;jt(null),qt(null);try{return e()}finally{jt(t),qt(n)}}function Js(e,t,n,r=n){e.addEventListener(t,()=>ai(n));const i=e.__on_r;i?e.__on_r=()=>{i(),r(!0)}:e.__on_r=()=>r(!0),oi()}const Zs=new Set,li=new Set;function Qs(e,t,n,r={}){function i(s){if(r.capture||Oe.call(t,s),!s.cancelBubble)return ai(()=>n==null?void 0:n.call(this,s))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?Rr(()=>{t.addEventListener(e,i,r)}):t.addEventListener(e,i,r),i}function fe(e,t,n,r,i){var s={capture:r,passive:i},o=Qs(e,t,n,s);(t===document.body||t===window||t===document)&&qn(()=>{t.removeEventListener(e,o,s)})}function Oe(e){var E;var t=this,n=t.ownerDocument,r=e.type,i=((E=e.composedPath)==null?void 0:E.call(e))||[],s=i[0]||e.target,o=0,l=e.__root;if(l){var c=i.indexOf(l);if(c!==-1&&(t===document||t===window)){e.__root=t;return}var u=i.indexOf(t);if(u===-1)return;c<=u&&(o=c)}if(s=i[o]||e.target,s!==t){Te(e,"currentTarget",{configurable:!0,get(){return s||n}});var f=O,d=M;jt(null),qt(null);try{for(var h,p=[];s!==null;){var m=s.assignedSlot||s.parentNode||s.host||null;try{var C=s["__"+r];if(C!==void 0&&(!s.disabled||e.target===s))if(Pn(C)){var[T,...b]=C;T.apply(s,[e,...b])}else C.call(s,e)}catch(R){h?p.push(R):h=R}if(e.cancelBubble||m===t||m===null)break;s=m}if(h){for(let R of p)queueMicrotask(()=>{throw R});throw h}}finally{e.__root=t,delete e.currentTarget,jt(f),qt(d)}}}function ui(e){var t=document.createElement("template");return t.innerHTML=e,t.content}function Vt(e,t){var n=M;n.nodes_start===null&&(n.nodes_start=e,n.nodes_end=t)}function te(e,t){var n=(t&us)!==0,r=(t&cs)!==0,i,s=!e.startsWith("<!>");return()=>{if(k)return Vt(L,null),L;i===void 0&&(i=ui(s?e:"<!>"+e),n||(i=Gt(i)));var o=r||Ir?document.importNode(i,!0):i.cloneNode(!0);if(n){var l=Gt(o),c=o.lastChild;Vt(l,c)}else Vt(o,o);return o}}function to(){if(k)return Vt(L,null),L;var e=document.createDocumentFragment(),t=document.createComment(""),n=Re();return e.append(t,n),Vt(t,n),e}function It(e,t){if(k){M.nodes_end=L,le();return}e!==null&&e.before(t)}function ci(e,t){return fi(e,t)}function eo(e,t){Bn(),t.intro=t.intro??!1;const n=t.target,r=k,i=L;try{for(var s=Gt(n);s&&(s.nodeType!==8||s.data!==br);)s=$t(s);if(!s)throw ie;Lt(!0),Et(s),le();const o=fi(e,{...t,anchor:s});if(L===null||L.nodeType!==8||L.data!==Nn)throw rn(),ie;return Lt(!1),o}catch(o){if(o===ie)return t.recover===!1&&As(),Bn(),Hr(n),Lt(!1),ci(e,t);throw o}finally{Lt(r),Et(i)}}const he=new Map;function fi(e,{target:t,anchor:n,props:r={},events:i,context:s,intro:o=!0}){Bn();var l=new Set,c=d=>{for(var h=0;h<d.length;h++){var p=d[h];if(!l.has(p)){l.add(p);var m=Ks(p);t.addEventListener(p,Oe,{passive:m});var C=he.get(p);C===void 0?(document.addEventListener(p,Oe,{passive:m}),he.set(p,1)):he.set(p,C+1)}}};c(In(Zs)),li.add(c);var u=void 0,f=qs(()=>{var d=n??t.appendChild(Re());return ce(()=>{if(s){ri({});var h=F;h.c=s}i&&(r.$$events=i),k&&Vt(d,null),u=e(d,r)||{},k&&(M.nodes_end=L),s&&ii()}),()=>{var m;for(var h of l){t.removeEventListener(h,Oe);var p=he.get(h);--p===0?(document.removeEventListener(h,Oe),he.delete(h)):he.set(h,p)}li.delete(c),d!==n&&((m=d.parentNode)==null||m.removeChild(d))}});return Kn.set(u,f),u}let Kn=new WeakMap;function no(e,t){const n=Kn.get(e);return n?(Kn.delete(e),n(t)):Promise.resolve()}function Ne(e,t,n=!1){k&&le();var r=e,i=null,s=null,o=at,l=n?$n:0,c=!1;const u=(d,h=!0)=>{c=!0,f(h,d)},f=(d,h)=>{if(o===(o=d))return;let p=!1;if(k){const m=r.data===On;!!o===m&&(r=Hn(),Et(r),Lt(!1),p=!0)}o?(i?_n(i):h&&(i=ce(()=>h(r))),s&&vn(s,()=>{s=null})):(s?_n(s):h&&(s=ce(()=>h(r))),i&&vn(i,()=>{i=null})),p&&Lt(!0)};mn(()=>{c=!1,t(u),c||f(null,null)},l),k&&(r=L)}function ro(e,t){return t}function io(e,t,n,r){for(var i=[],s=t.length,o=0;o<s;o++)Xn(t[o].e,i,!0);var l=s>0&&i.length===0&&n!==null;if(l){var c=n.parentNode;Hr(c),c.append(n),r.clear(),Xt(e,t[0].prev,t[s-1].next)}ti(i,()=>{for(var u=0;u<s;u++){var f=t[u];l||(r.delete(f.k),Xt(e,f.prev,f.next)),xt(f.e,!l)}})}function so(e,t,n,r,i,s=null){var o=e,l={flags:t,items:new Map,first:null};{var c=e;o=k?Et(Gt(c)):c.appendChild(Re())}k&&le();var u=null,f=!1,d=Or(()=>{var h=n();return Pn(h)?h:h==null?[]:In(h)});mn(()=>{var h=S(d),p=h.length;if(f&&p===0)return;f=p===0;let m=!1;if(k){var C=o.data===On;C!==(p===0)&&(o=Hn(),Et(o),Lt(!1),m=!0)}if(k){for(var T=null,b,E=0;E<p;E++){if(L.nodeType===8&&L.data===Nn){o=L,m=!0,Lt(!1);break}var R=h[E],w=r(R,E);b=hi(L,l,T,null,R,w,E,i,t,n),l.items.set(w,b),T=b}p>0&&Et(Hn())}k||oo(h,l,o,i,t,r,n),s!==null&&(p===0?u?_n(u):u=ce(()=>s(o)):u!==null&&vn(u,()=>{u=null})),m&&Lt(!0),S(d)}),k&&(o=L)}function oo(e,t,n,r,i,s,o){var l=e.length,c=t.items,u=t.first,f=u,d,h=null,p=[],m=[],C,T,b,E;for(E=0;E<l;E+=1){if(C=e[E],T=s(C,E),b=c.get(T),b===void 0){var R=f?f.e.nodes_start:n;h=hi(R,t,h,h===null?t.first:h.next,C,T,E,r,i,o),c.set(T,h),p=[],m=[],f=h.next;continue}if(ao(b,C,E),(b.e.f&Nt)!==0&&_n(b.e),b!==f){if(d!==void 0&&d.has(b)){if(p.length<m.length){var w=m[0],g;h=w.prev;var D=p[0],z=p[p.length-1];for(g=0;g<p.length;g+=1)di(p[g],w,n);for(g=0;g<m.length;g+=1)d.delete(m[g]);Xt(t,D.prev,z.next),Xt(t,h,D),Xt(t,z,w),f=w,h=z,E-=1,p=[],m=[]}else d.delete(b),di(b,f,n),Xt(t,b.prev,b.next),Xt(t,b,h===null?t.first:h.next),Xt(t,h,b),h=b;continue}for(p=[],m=[];f!==null&&f.k!==T;)(f.e.f&Nt)===0&&(d??(d=new Set)).add(f),m.push(f),f=f.next;if(f===null)continue;b=f}p.push(b),h=b,f=b.next}if(f!==null||d!==void 0){for(var q=d===void 0?[]:In(d);f!==null;)(f.e.f&Nt)===0&&q.push(f),f=f.next;var st=q.length;if(st>0){var pt=l===0?n:null;io(t,q,pt,c)}}M.first=t.first&&t.first.e,M.last=h&&h.e}function ao(e,t,n,r){Mr(e.v,t),e.i=n}function hi(e,t,n,r,i,s,o,l,c,u){var f=(c&is)!==0,d=(c&os)===0,h=f?d?Ae(i):_t(i):i,p=(c&ss)===0?o:_t(o),m={i:p,v:h,k:s,a:null,e:null,prev:n,next:r};try{return m.e=ce(()=>l(e,h,p,u),k),m.e.prev=n&&n.e,m.e.next=r&&r.e,n===null?t.first=m:(n.next=m,n.e.next=m.e),r!==null&&(r.prev=m,r.e.prev=m.e),m}finally{}}function di(e,t,n){for(var r=e.next?e.next.e.nodes_start:n,i=t?t.e.nodes_start:n,s=e.e.nodes_start;s!==r;){var o=$t(s);i.before(s),s=o}}function Xt(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function lo(e,t,n,r,i){var s=e,o="",l;mn(()=>{if(o===(o=t()??"")){k&&le();return}l!==void 0&&(xt(l),l=void 0),o!==""&&(l=ce(()=>{if(k){L.data;for(var c=le(),u=c;c!==null&&(c.nodeType!==8||c.data!=="");)u=c,c=$t(c);if(c===null)throw rn(),ie;Vt(L,u),s=Et(c);return}var f=o+"",d=ui(f);Vt(Gt(d),d.lastChild),s.before(d)}))})}function uo(e,t,n){pn(()=>{var r=Zt(()=>t(e,n==null?void 0:n())||{});if(n&&(r!=null&&r.update)){var i=!1,s={};Me(()=>{var o=n();Xr(o),i&&Fn(s,o)&&(s=o,r.update(o))}),i=!0}if(r!=null&&r.destroy)return()=>r.destroy()})}function co(e,t,n){var r=e==null?"":""+e;return r===""?null:r}function fo(e,t,n,r,i,s){var o=e.__className;if(k||o!==n){var l=co(n);(!k||l!==e.getAttribute("class"))&&(l==null?e.removeAttribute("class"):e.className=l),e.__className=n}return s}function ho(e){if(k){var t=!1,n=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var r=e.value;ee(e,"value",null),e.value=r}if(e.hasAttribute("checked")){var i=e.checked;ee(e,"checked",null),e.checked=i}}};e.__on_r=n,ys(n),oi()}}function ee(e,t,n,r){var i=e.__attributes??(e.__attributes={});k&&(i[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||i[t]!==(i[t]=n)&&(t==="style"&&"__styles"in e&&(e.__styles={}),t==="loading"&&(e[ps]=n),n==null?e.removeAttribute(t):typeof n!="string"&&po(e).includes(t)?e[t]=n:e.setAttribute(t,n))}var pi=new Map;function po(e){var t=pi.get(e.nodeName);if(t)return t;pi.set(e.nodeName,t=[]);for(var n,r=e,i=Element.prototype;i!==r;){n=Sr(r);for(var s in n)n[s].set&&t.push(s);r=Un(r)}return t}function mo(e,t,n=t){var r=De();Js(e,"input",i=>{var s=i?e.defaultValue:e.value;if(s=Jn(e)?Zn(s):s,n(s),r&&s!==(s=t())){var o=e.selectionStart,l=e.selectionEnd;e.value=s??"",l!==null&&(e.selectionStart=o,e.selectionEnd=Math.min(l,e.value.length))}}),(k&&e.defaultValue!==e.value||Zt(t)==null&&e.value)&&n(Jn(e)?Zn(e.value):e.value),Me(()=>{var i=t();Jn(e)&&i===Zn(e.value)||e.type==="date"&&!i&&!e.value||i!==e.value&&(e.value=i??"")})}function Jn(e){var t=e.type;return t==="number"||t==="range"}function Zn(e){return e===""?null:+e}function vo(e,t,n){var r=zt(e,t);r&&r.set&&(e[t]=n,qn(()=>{e[t]=null}))}function mi(e,t){return e===t||(e==null?void 0:e[Jt])===t}function _o(e={},t,n,r){return pn(()=>{var i,s;return Me(()=>{i=s,s=[],Zt(()=>{e!==n(...s)&&(t(e,...s),i&&mi(n(...i),e)&&t(null,...i))})}),()=>{Rr(()=>{s&&mi(n(...s),e)&&t(null,...s)})}}),e}function go(e=!1){const t=F,n=t.l.u;if(!n)return;let r=()=>Xr(t.s);if(e){let i=0,s={};const o=nn(()=>{let l=!1;const c=t.s;for(const u in c)c[u]!==s[u]&&(s[u]=c[u],l=!0);return l&&i++,i});r=()=>S(o)}n.b.length&&Gs(()=>{vi(t,r),en(n.b)}),Yn(()=>{const i=Zt(()=>n.m.map(gs));return()=>{for(const s of i)typeof s=="function"&&s()}}),n.a.length&&Yn(()=>{vi(t,r),en(n.a)})}function vi(e,t){if(e.l.s)for(const n of e.l.s)S(n);t()}function bo(e){F===null&&Vs(),x&&F.l!==null?yo(F).m.push(e):Yn(()=>{const t=Zt(e);if(typeof t=="function")return t})}function yo(e){var t=e.l;return t.u??(t.u={a:[],b:[],m:[]})}function _i(e,t,n){if(e==null)return t(void 0),ae;const r=Zt(()=>e.subscribe(t,n));return r.unsubscribe?()=>r.unsubscribe():r}const de=[];function Eo(e,t=ae){let n=null;const r=new Set;function i(l){if(Fn(e,l)&&(e=l,n)){const c=!de.length;for(const u of r)u[1](),de.push(u,e);if(c){for(let u=0;u<de.length;u+=2)de[u][0](de[u+1]);de.length=0}}}function s(l){i(l(e))}function o(l,c=ae){const u=[l,c];return r.add(u),r.size===1&&(n=t(i,s)||ae),l(e),()=>{r.delete(u),r.size===0&&n&&(n(),n=null)}}return{set:i,update:s,subscribe:o}}function To(e){let t;return _i(e,n=>t=n)(),t}let gn=!1,Qn=Symbol();function wo(e,t,n){const r=n[t]??(n[t]={store:null,source:Ae(void 0),unsubscribe:ae});if(r.store!==e&&!(Qn in n))if(r.unsubscribe(),r.store=e??null,e==null)r.source.v=void 0,r.unsubscribe=ae;else{var i=!0;r.unsubscribe=_i(e,s=>{i?r.source.v=s:G(r.source,s)}),i=!1}return e&&Qn in n?To(e):S(r.source)}function So(){const e={};function t(){qn(()=>{for(var n in e)e[n].unsubscribe();Te(e,Qn,{enumerable:!1,value:!0})})}return[e,t]}function Ao(e){var t=gn;try{return gn=!1,[e(),gn]}finally{gn=t}}function gi(e,t,n,r){var w;var i=!x||(n&as)!==0,s=(n&ls)!==0,o=!1,l;[l,o]=Ao(()=>e[t]);var c=Jt in e||wr in e,u=(((w=zt(e,t))==null?void 0:w.set)??(c&&t in e&&(g=>e[t]=g)))||void 0,f=r,d=!0,h=!1,p=()=>(h=!0,d&&(d=!1,f=r),f);l===void 0&&r!==void 0&&(u&&i&&Cs(),l=p(),u&&u(l));var m;if(i)m=()=>{var g=e[t];return g===void 0?p():(d=!0,h=!1,g)};else{var C=Or(()=>e[t]);C.f|=hs,m=()=>{var g=S(C);return g!==void 0&&(f=void 0),g===void 0?f:g}}if(u){var T=e.$$legacy;return function(g,D){return arguments.length>0?((!i||!D||T||o)&&u(D?m():g),g):m()}}var b=!1,E=Ae(l),R=nn(()=>{var g=m(),D=S(E);return b?(b=!1,D):E.v=g});return R.equals=Wn,function(g,D){if(arguments.length>0){const z=D?S(R):i&&s?ue(g):g;return R.equals(z)||(b=!0,G(E,z),h&&f!==void 0&&(f=z),Zt(()=>S(R))),g}return S(R)}}function Co(e){return new Ro(e)}class Ro{constructor(t){_r(this,Ut);_r(this,bt);var s;var n=new Map,r=(o,l)=>{var c=Ae(l);return n.set(o,c),c};const i=new Proxy({...t.props||{},$$events:{}},{get(o,l){return S(n.get(l)??r(l,Reflect.get(o,l)))},has(o,l){return l===wr?!0:(S(n.get(l)??r(l,Reflect.get(o,l))),Reflect.has(o,l))},set(o,l,c){return G(n.get(l)??r(l,c),c),Reflect.set(o,l,c)}});gr(this,bt,(t.hydrate?eo:ci)(t.component,{target:t.target,anchor:t.anchor,props:i,context:t.context,intro:t.intro??!1,recover:t.recover})),(!((s=t==null?void 0:t.props)!=null&&s.$$host)||t.sync===!1)&&dn(),gr(this,Ut,i.$$events);for(const o of Object.keys(ht(this,bt)))o==="$set"||o==="$destroy"||o==="$on"||Te(this,o,{get(){return ht(this,bt)[o]},set(l){ht(this,bt)[o]=l},enumerable:!0});ht(this,bt).$set=o=>{Object.assign(i,o)},ht(this,bt).$destroy=()=>{no(ht(this,bt))}}$set(t){ht(this,bt).$set(t)}$on(t,n){ht(this,Ut)[t]=ht(this,Ut)[t]||[];const r=(...i)=>n.call(this,...i);return ht(this,Ut)[t].push(r),()=>{ht(this,Ut)[t]=ht(this,Ut)[t].filter(i=>i!==r)}}$destroy(){ht(this,bt).$destroy()}}Ut=new WeakMap,bt=new WeakMap;let bi;typeof HTMLElement=="function"&&(bi=class extends HTMLElement{constructor(t,n,r){super();J(this,"$$ctor");J(this,"$$s");J(this,"$$c");J(this,"$$cn",!1);J(this,"$$d",{});J(this,"$$r",!1);J(this,"$$p_d",{});J(this,"$$l",{});J(this,"$$l_u",new Map);J(this,"$$me");this.$$ctor=t,this.$$s=n,r&&this.attachShadow({mode:"open"})}addEventListener(t,n,r){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(n),this.$$c){const i=this.$$c.$on(t,n);this.$$l_u.set(n,i)}super.addEventListener(t,n,r)}removeEventListener(t,n,r){if(super.removeEventListener(t,n,r),this.$$c){const i=this.$$l_u.get(n);i&&(i(),this.$$l_u.delete(n))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(i){return s=>{const o=document.createElement("slot");i!=="default"&&(o.name=i),It(s,o)}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;const n={},r=xo(this);for(const i of this.$$s)i in r&&(i==="default"&&!this.$$d.children?(this.$$d.children=t(i),n.default=!0):n[i]=t(i));for(const i of this.attributes){const s=this.$$g_p(i.name);s in this.$$d||(this.$$d[s]=bn(s,i.value,this.$$p_d,"toProp"))}for(const i in this.$$p_d)!(i in this.$$d)&&this[i]!==void 0&&(this.$$d[i]=this[i],delete this[i]);this.$$c=Co({component:this.$$ctor,target:this.shadowRoot||this,props:{...this.$$d,$$slots:n,$$host:this}}),this.$$me=js(()=>{Me(()=>{var i;this.$$r=!0;for(const s of tn(this.$$c)){if(!((i=this.$$p_d[s])!=null&&i.reflect))continue;this.$$d[s]=this.$$c[s];const o=bn(s,this.$$d[s],this.$$p_d,"toAttribute");o==null?this.removeAttribute(this.$$p_d[s].attribute||s):this.setAttribute(this.$$p_d[s].attribute||s,o)}this.$$r=!1})});for(const i in this.$$l)for(const s of this.$$l[i]){const o=this.$$c.$on(i,s);this.$$l_u.set(s,o)}this.$$l={}}}attributeChangedCallback(t,n,r){var i;this.$$r||(t=this.$$g_p(t),this.$$d[t]=bn(t,r,this.$$p_d,"toProp"),(i=this.$$c)==null||i.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$me(),this.$$c=void 0)})}$$g_p(t){return tn(this.$$p_d).find(n=>this.$$p_d[n].attribute===t||!this.$$p_d[n].attribute&&n.toLowerCase()===t)||t}});function bn(e,t,n,r){var s;const i=(s=n[e])==null?void 0:s.type;if(t=i==="Boolean"&&typeof t!="boolean"?t!=null:t,!r||!n[e])return t;if(r==="toAttribute")switch(i){case"Object":case"Array":return t==null?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t??null;default:return t}else switch(i){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":return t;case"Number":return t!=null?+t:t;default:return t}}function xo(e){const t={};return e.childNodes.forEach(n=>{t[n.slot||"default"]=!0}),t}function ko(e,t,n,r,i,s){let o=class extends bi{constructor(){super(e,n,i),this.$$p_d=t}static get observedAttributes(){return tn(t).map(l=>(t[l].attribute||l).toLowerCase())}};return tn(t).forEach(l=>{Te(o.prototype,l,{get(){return this.$$c&&l in this.$$c?this.$$c[l]:this.$$d[l]},set(c){var d;c=bn(l,c,t),this.$$d[l]=c;var u=this.$$c;if(u){var f=(d=zt(u,l))==null?void 0:d.get;f?u[l]=c:u.$set({[l]:c})}}})}),r.forEach(l=>{Te(o.prototype,l,{get(){var c;return(c=this.$$c)==null?void 0:c[l]}})}),e.element=o,o}const Mo=async e=>{console.log("Sending request to server:",e);const t={...e,user_id:e.user_id},n=await fetch("https://api.blacksmith-lab.com/blacksmith_web_user_request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok){let i;try{i=await n.json()}catch{i=await n.text()}throw console.error(`Error processing request (${n.status}):`,i),new Error(`Error processing request: ${n.status} - ${JSON.stringify(i)}`)}const r=await n.json();return console.log("Server response data:",r),r},Do=async e=>{console.log("Sending TTS request:",e);const t=await fetch("https://api.blacksmith-lab.com/blacksmith_web_tts_request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let r;try{r=await t.json()}catch{r=await t.text()}throw console.error(`TTS Error (${t.status}):`,r),new Error(`TTS Error: ${t.status} - ${JSON.stringify(r)}`)}const n=await t.json();return console.log("TTS response received"),n},Oo=async(e,t)=>{console.log("Fetching chat history for user:",e);const n=await fetch(`https://api.blacksmith-lab.com/blacksmith_web_chat_fetch?user_id=${e}&app_name=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok){let i;try{i=await n.json()}catch{i=await n.text()}throw console.error(`Error fetching chat history (${n.status}):`,i),new Error(`Error fetching chat history: ${n.status} - ${JSON.stringify(i)}`)}const r=await n.json();return console.log("Loaded chat history for user:",e,":",r),r};/*! @license DOMPurify 3.2.4 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.4/LICENSE */const{entries:yi,setPrototypeOf:Ei,isFrozen:No,getPrototypeOf:Lo,getOwnPropertyDescriptor:$o}=Object;let{freeze:nt,seal:gt,create:Ti}=Object,{apply:tr,construct:er}=typeof Reflect<"u"&&Reflect;nt||(nt=function(t){return t}),gt||(gt=function(t){return t}),tr||(tr=function(t,n,r){return t.apply(n,r)}),er||(er=function(t,n){return new t(...n)});const yn=it(Array.prototype.forEach),Po=it(Array.prototype.lastIndexOf),wi=it(Array.prototype.pop),Le=it(Array.prototype.push),Io=it(Array.prototype.splice),En=it(String.prototype.toLowerCase),nr=it(String.prototype.toString),Si=it(String.prototype.match),$e=it(String.prototype.replace),Uo=it(String.prototype.indexOf),Fo=it(String.prototype.trim),wt=it(Object.prototype.hasOwnProperty),rt=it(RegExp.prototype.test),Pe=Wo(TypeError);function it(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return tr(e,t,r)}}function Wo(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return er(e,n)}}function A(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:En;Ei&&Ei(e,null);let r=t.length;for(;r--;){let i=t[r];if(typeof i=="string"){const s=n(i);s!==i&&(No(t)||(t[r]=s),i=s)}e[i]=!0}return e}function Ho(e){for(let t=0;t<e.length;t++)wt(e,t)||(e[t]=null);return e}function ne(e){const t=Ti(null);for(const[n,r]of yi(e))wt(e,n)&&(Array.isArray(r)?t[n]=Ho(r):r&&typeof r=="object"&&r.constructor===Object?t[n]=ne(r):t[n]=r);return t}function Ie(e,t){for(;e!==null;){const r=$o(e,t);if(r){if(r.get)return it(r.get);if(typeof r.value=="function")return it(r.value)}e=Lo(e)}function n(){return null}return n}const Ai=nt(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),rr=nt(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ir=nt(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Bo=nt(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),sr=nt(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),zo=nt(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ci=nt(["#text"]),Ri=nt(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),or=nt(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),xi=nt(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Tn=nt(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Go=gt(/\{\{[\w\W]*|[\w\W]*\}\}/gm),jo=gt(/<%[\w\W]*|[\w\W]*%>/gm),qo=gt(/\$\{[\w\W]*/gm),Yo=gt(/^data-[\-\w.\u00B7-\uFFFF]+$/),Vo=gt(/^aria-[\-\w]+$/),ki=gt(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Xo=gt(/^(?:\w+script|data):/i),Ko=gt(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Mi=gt(/^html$/i),Jo=gt(/^[a-z][.\w]*(-[.\w]+)+$/i);var Di=Object.freeze({__proto__:null,ARIA_ATTR:Vo,ATTR_WHITESPACE:Ko,CUSTOM_ELEMENT:Jo,DATA_ATTR:Yo,DOCTYPE_NAME:Mi,ERB_EXPR:jo,IS_ALLOWED_URI:ki,IS_SCRIPT_OR_DATA:Xo,MUSTACHE_EXPR:Go,TMPLIT_EXPR:qo});const Ue={element:1,text:3,progressingInstruction:7,comment:8,document:9},Zo=function(){return typeof window>"u"?null:window},Qo=function(t,n){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let r=null;const i="data-tt-policy-suffix";n&&n.hasAttribute(i)&&(r=n.getAttribute(i));const s="dompurify"+(r?"#"+r:"");try{return t.createPolicy(s,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},Oi=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Ni(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Zo();const t=y=>Ni(y);if(t.version="3.2.4",t.removed=[],!e||!e.document||e.document.nodeType!==Ue.document||!e.Element)return t.isSupported=!1,t;let{document:n}=e;const r=n,i=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:o,Node:l,Element:c,NodeFilter:u,NamedNodeMap:f=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:d,DOMParser:h,trustedTypes:p}=e,m=c.prototype,C=Ie(m,"cloneNode"),T=Ie(m,"remove"),b=Ie(m,"nextSibling"),E=Ie(m,"childNodes"),R=Ie(m,"parentNode");if(typeof o=="function"){const y=n.createElement("template");y.content&&y.content.ownerDocument&&(n=y.content.ownerDocument)}let w,g="";const{implementation:D,createNodeIterator:z,createDocumentFragment:q,getElementsByTagName:st}=n,{importNode:pt}=r;let H=Oi();t.isSupported=typeof yi=="function"&&typeof R=="function"&&D&&D.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Kt,ERB_EXPR:He,TMPLIT_EXPR:Be,DATA_ATTR:lr,ARIA_ATTR:ur,IS_SCRIPT_OR_DATA:cr,ATTR_WHITESPACE:$,CUSTOM_ELEMENT:I}=Di;let{IS_ALLOWED_URI:B}=Di,P=null;const me=A({},[...Ai,...rr,...ir,...sr,...Ci]);let j=null;const Sn=A({},[...Ri,...or,...xi,...Tn]);let W=Object.seal(Ti(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),re=null,ze=null,mt=!0,ut=!0,St=!1,ve=!0,ct=!1,Ft=!0,Wt=!1,Ge=!1,je=!1,_e=!1,An=!1,Cn=!1,Ui=!0,Fi=!1;const Ta="user-content-";let fr=!0,qe=!1,ge={},be=null;const Wi=A({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Hi=null;const Bi=A({},["audio","video","img","source","image","track"]);let hr=null;const zi=A({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Rn="http://www.w3.org/1998/Math/MathML",xn="http://www.w3.org/2000/svg",Ht="http://www.w3.org/1999/xhtml";let ye=Ht,dr=!1,pr=null;const wa=A({},[Rn,xn,Ht],nr);let kn=A({},["mi","mo","mn","ms","mtext"]),Mn=A({},["annotation-xml"]);const Sa=A({},["title","style","font","a","script"]);let Ye=null;const Aa=["application/xhtml+xml","text/html"],Ca="text/html";let Y=null,Ee=null;const Ra=n.createElement("form"),Gi=function(a){return a instanceof RegExp||a instanceof Function},mr=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Ee&&Ee===a)){if((!a||typeof a!="object")&&(a={}),a=ne(a),Ye=Aa.indexOf(a.PARSER_MEDIA_TYPE)===-1?Ca:a.PARSER_MEDIA_TYPE,Y=Ye==="application/xhtml+xml"?nr:En,P=wt(a,"ALLOWED_TAGS")?A({},a.ALLOWED_TAGS,Y):me,j=wt(a,"ALLOWED_ATTR")?A({},a.ALLOWED_ATTR,Y):Sn,pr=wt(a,"ALLOWED_NAMESPACES")?A({},a.ALLOWED_NAMESPACES,nr):wa,hr=wt(a,"ADD_URI_SAFE_ATTR")?A(ne(zi),a.ADD_URI_SAFE_ATTR,Y):zi,Hi=wt(a,"ADD_DATA_URI_TAGS")?A(ne(Bi),a.ADD_DATA_URI_TAGS,Y):Bi,be=wt(a,"FORBID_CONTENTS")?A({},a.FORBID_CONTENTS,Y):Wi,re=wt(a,"FORBID_TAGS")?A({},a.FORBID_TAGS,Y):{},ze=wt(a,"FORBID_ATTR")?A({},a.FORBID_ATTR,Y):{},ge=wt(a,"USE_PROFILES")?a.USE_PROFILES:!1,mt=a.ALLOW_ARIA_ATTR!==!1,ut=a.ALLOW_DATA_ATTR!==!1,St=a.ALLOW_UNKNOWN_PROTOCOLS||!1,ve=a.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ct=a.SAFE_FOR_TEMPLATES||!1,Ft=a.SAFE_FOR_XML!==!1,Wt=a.WHOLE_DOCUMENT||!1,_e=a.RETURN_DOM||!1,An=a.RETURN_DOM_FRAGMENT||!1,Cn=a.RETURN_TRUSTED_TYPE||!1,je=a.FORCE_BODY||!1,Ui=a.SANITIZE_DOM!==!1,Fi=a.SANITIZE_NAMED_PROPS||!1,fr=a.KEEP_CONTENT!==!1,qe=a.IN_PLACE||!1,B=a.ALLOWED_URI_REGEXP||ki,ye=a.NAMESPACE||Ht,kn=a.MATHML_TEXT_INTEGRATION_POINTS||kn,Mn=a.HTML_INTEGRATION_POINTS||Mn,W=a.CUSTOM_ELEMENT_HANDLING||{},a.CUSTOM_ELEMENT_HANDLING&&Gi(a.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(W.tagNameCheck=a.CUSTOM_ELEMENT_HANDLING.tagNameCheck),a.CUSTOM_ELEMENT_HANDLING&&Gi(a.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(W.attributeNameCheck=a.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),a.CUSTOM_ELEMENT_HANDLING&&typeof a.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(W.allowCustomizedBuiltInElements=a.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ct&&(ut=!1),An&&(_e=!0),ge&&(P=A({},Ci),j=[],ge.html===!0&&(A(P,Ai),A(j,Ri)),ge.svg===!0&&(A(P,rr),A(j,or),A(j,Tn)),ge.svgFilters===!0&&(A(P,ir),A(j,or),A(j,Tn)),ge.mathMl===!0&&(A(P,sr),A(j,xi),A(j,Tn))),a.ADD_TAGS&&(P===me&&(P=ne(P)),A(P,a.ADD_TAGS,Y)),a.ADD_ATTR&&(j===Sn&&(j=ne(j)),A(j,a.ADD_ATTR,Y)),a.ADD_URI_SAFE_ATTR&&A(hr,a.ADD_URI_SAFE_ATTR,Y),a.FORBID_CONTENTS&&(be===Wi&&(be=ne(be)),A(be,a.FORBID_CONTENTS,Y)),fr&&(P["#text"]=!0),Wt&&A(P,["html","head","body"]),P.table&&(A(P,["tbody"]),delete re.tbody),a.TRUSTED_TYPES_POLICY){if(typeof a.TRUSTED_TYPES_POLICY.createHTML!="function")throw Pe('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof a.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Pe('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');w=a.TRUSTED_TYPES_POLICY,g=w.createHTML("")}else w===void 0&&(w=Qo(p,i)),w!==null&&typeof g=="string"&&(g=w.createHTML(""));nt&&nt(a),Ee=a}},ji=A({},[...rr,...ir,...Bo]),qi=A({},[...sr,...zo]),xa=function(a){let v=R(a);(!v||!v.tagName)&&(v={namespaceURI:ye,tagName:"template"});const _=En(a.tagName),U=En(v.tagName);return pr[a.namespaceURI]?a.namespaceURI===xn?v.namespaceURI===Ht?_==="svg":v.namespaceURI===Rn?_==="svg"&&(U==="annotation-xml"||kn[U]):!!ji[_]:a.namespaceURI===Rn?v.namespaceURI===Ht?_==="math":v.namespaceURI===xn?_==="math"&&Mn[U]:!!qi[_]:a.namespaceURI===Ht?v.namespaceURI===xn&&!Mn[U]||v.namespaceURI===Rn&&!kn[U]?!1:!qi[_]&&(Sa[_]||!ji[_]):!!(Ye==="application/xhtml+xml"&&pr[a.namespaceURI]):!1},kt=function(a){Le(t.removed,{element:a});try{R(a).removeChild(a)}catch{T(a)}},Dn=function(a,v){try{Le(t.removed,{attribute:v.getAttributeNode(a),from:v})}catch{Le(t.removed,{attribute:null,from:v})}if(v.removeAttribute(a),a==="is")if(_e||An)try{kt(v)}catch{}else try{v.setAttribute(a,"")}catch{}},Yi=function(a){let v=null,_=null;if(je)a="<remove></remove>"+a;else{const K=Si(a,/^[\r\n\t ]+/);_=K&&K[0]}Ye==="application/xhtml+xml"&&ye===Ht&&(a='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+a+"</body></html>");const U=w?w.createHTML(a):a;if(ye===Ht)try{v=new h().parseFromString(U,Ye)}catch{}if(!v||!v.documentElement){v=D.createDocument(ye,"template",null);try{v.documentElement.innerHTML=dr?g:U}catch{}}const Z=v.body||v.documentElement;return a&&_&&Z.insertBefore(n.createTextNode(_),Z.childNodes[0]||null),ye===Ht?st.call(v,Wt?"html":"body")[0]:Wt?v.documentElement:Z},Vi=function(a){return z.call(a.ownerDocument||a,a,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},vr=function(a){return a instanceof d&&(typeof a.nodeName!="string"||typeof a.textContent!="string"||typeof a.removeChild!="function"||!(a.attributes instanceof f)||typeof a.removeAttribute!="function"||typeof a.setAttribute!="function"||typeof a.namespaceURI!="string"||typeof a.insertBefore!="function"||typeof a.hasChildNodes!="function")},Xi=function(a){return typeof l=="function"&&a instanceof l};function Bt(y,a,v){yn(y,_=>{_.call(t,a,v,Ee)})}const Ki=function(a){let v=null;if(Bt(H.beforeSanitizeElements,a,null),vr(a))return kt(a),!0;const _=Y(a.nodeName);if(Bt(H.uponSanitizeElement,a,{tagName:_,allowedTags:P}),a.hasChildNodes()&&!Xi(a.firstElementChild)&&rt(/<[/\w]/g,a.innerHTML)&&rt(/<[/\w]/g,a.textContent)||a.nodeType===Ue.progressingInstruction||Ft&&a.nodeType===Ue.comment&&rt(/<[/\w]/g,a.data))return kt(a),!0;if(!P[_]||re[_]){if(!re[_]&&Zi(_)&&(W.tagNameCheck instanceof RegExp&&rt(W.tagNameCheck,_)||W.tagNameCheck instanceof Function&&W.tagNameCheck(_)))return!1;if(fr&&!be[_]){const U=R(a)||a.parentNode,Z=E(a)||a.childNodes;if(Z&&U){const K=Z.length;for(let ft=K-1;ft>=0;--ft){const Mt=C(Z[ft],!0);Mt.__removalCount=(a.__removalCount||0)+1,U.insertBefore(Mt,b(a))}}}return kt(a),!0}return a instanceof c&&!xa(a)||(_==="noscript"||_==="noembed"||_==="noframes")&&rt(/<\/no(script|embed|frames)/i,a.innerHTML)?(kt(a),!0):(ct&&a.nodeType===Ue.text&&(v=a.textContent,yn([Kt,He,Be],U=>{v=$e(v,U," ")}),a.textContent!==v&&(Le(t.removed,{element:a.cloneNode()}),a.textContent=v)),Bt(H.afterSanitizeElements,a,null),!1)},Ji=function(a,v,_){if(Ui&&(v==="id"||v==="name")&&(_ in n||_ in Ra))return!1;if(!(ut&&!ze[v]&&rt(lr,v))){if(!(mt&&rt(ur,v))){if(!j[v]||ze[v]){if(!(Zi(a)&&(W.tagNameCheck instanceof RegExp&&rt(W.tagNameCheck,a)||W.tagNameCheck instanceof Function&&W.tagNameCheck(a))&&(W.attributeNameCheck instanceof RegExp&&rt(W.attributeNameCheck,v)||W.attributeNameCheck instanceof Function&&W.attributeNameCheck(v))||v==="is"&&W.allowCustomizedBuiltInElements&&(W.tagNameCheck instanceof RegExp&&rt(W.tagNameCheck,_)||W.tagNameCheck instanceof Function&&W.tagNameCheck(_))))return!1}else if(!hr[v]){if(!rt(B,$e(_,$,""))){if(!((v==="src"||v==="xlink:href"||v==="href")&&a!=="script"&&Uo(_,"data:")===0&&Hi[a])){if(!(St&&!rt(cr,$e(_,$,"")))){if(_)return!1}}}}}}return!0},Zi=function(a){return a!=="annotation-xml"&&Si(a,I)},Qi=function(a){Bt(H.beforeSanitizeAttributes,a,null);const{attributes:v}=a;if(!v||vr(a))return;const _={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:j,forceKeepAttr:void 0};let U=v.length;for(;U--;){const Z=v[U],{name:K,namespaceURI:ft,value:Mt}=Z,Ve=Y(K);let ot=K==="value"?Mt:Fo(Mt);if(_.attrName=Ve,_.attrValue=ot,_.keepAttr=!0,_.forceKeepAttr=void 0,Bt(H.uponSanitizeAttribute,a,_),ot=_.attrValue,Fi&&(Ve==="id"||Ve==="name")&&(Dn(K,a),ot=Ta+ot),Ft&&rt(/((--!?|])>)|<\/(style|title)/i,ot)){Dn(K,a);continue}if(_.forceKeepAttr||(Dn(K,a),!_.keepAttr))continue;if(!ve&&rt(/\/>/i,ot)){Dn(K,a);continue}ct&&yn([Kt,He,Be],es=>{ot=$e(ot,es," ")});const ts=Y(a.nodeName);if(Ji(ts,Ve,ot)){if(w&&typeof p=="object"&&typeof p.getAttributeType=="function"&&!ft)switch(p.getAttributeType(ts,Ve)){case"TrustedHTML":{ot=w.createHTML(ot);break}case"TrustedScriptURL":{ot=w.createScriptURL(ot);break}}try{ft?a.setAttributeNS(ft,K,ot):a.setAttribute(K,ot),vr(a)?kt(a):wi(t.removed)}catch{}}}Bt(H.afterSanitizeAttributes,a,null)},ka=function y(a){let v=null;const _=Vi(a);for(Bt(H.beforeSanitizeShadowDOM,a,null);v=_.nextNode();)Bt(H.uponSanitizeShadowNode,v,null),Ki(v),Qi(v),v.content instanceof s&&y(v.content);Bt(H.afterSanitizeShadowDOM,a,null)};return t.sanitize=function(y){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=null,_=null,U=null,Z=null;if(dr=!y,dr&&(y="<!-->"),typeof y!="string"&&!Xi(y))if(typeof y.toString=="function"){if(y=y.toString(),typeof y!="string")throw Pe("dirty is not a string, aborting")}else throw Pe("toString is not a function");if(!t.isSupported)return y;if(Ge||mr(a),t.removed=[],typeof y=="string"&&(qe=!1),qe){if(y.nodeName){const Mt=Y(y.nodeName);if(!P[Mt]||re[Mt])throw Pe("root node is forbidden and cannot be sanitized in-place")}}else if(y instanceof l)v=Yi("<!---->"),_=v.ownerDocument.importNode(y,!0),_.nodeType===Ue.element&&_.nodeName==="BODY"||_.nodeName==="HTML"?v=_:v.appendChild(_);else{if(!_e&&!ct&&!Wt&&y.indexOf("<")===-1)return w&&Cn?w.createHTML(y):y;if(v=Yi(y),!v)return _e?null:Cn?g:""}v&&je&&kt(v.firstChild);const K=Vi(qe?y:v);for(;U=K.nextNode();)Ki(U),Qi(U),U.content instanceof s&&ka(U.content);if(qe)return y;if(_e){if(An)for(Z=q.call(v.ownerDocument);v.firstChild;)Z.appendChild(v.firstChild);else Z=v;return(j.shadowroot||j.shadowrootmode)&&(Z=pt.call(r,Z,!0)),Z}let ft=Wt?v.outerHTML:v.innerHTML;return Wt&&P["!doctype"]&&v.ownerDocument&&v.ownerDocument.doctype&&v.ownerDocument.doctype.name&&rt(Mi,v.ownerDocument.doctype.name)&&(ft="<!DOCTYPE "+v.ownerDocument.doctype.name+`>
`+ft),ct&&yn([Kt,He,Be],Mt=>{ft=$e(ft,Mt," ")}),w&&Cn?w.createHTML(ft):ft},t.setConfig=function(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};mr(y),Ge=!0},t.clearConfig=function(){Ee=null,Ge=!1},t.isValidAttribute=function(y,a,v){Ee||mr({});const _=Y(y),U=Y(a);return Ji(_,U,v)},t.addHook=function(y,a){typeof a=="function"&&Le(H[y],a)},t.removeHook=function(y,a){if(a!==void 0){const v=Po(H[y],a);return v===-1?void 0:Io(H[y],v,1)[0]}return wi(H[y])},t.removeHooks=function(y){H[y]=[]},t.removeAllHooks=function(){H=Oi()},t}var ta=Ni();class Li{constructor({messages:t,dotsUpdateInterval:n=500,baseText:r=""}){J(this,"messages");J(this,"isAnimating",!1);J(this,"intervalId");J(this,"tempMessageId");J(this,"dotsUpdateInterval");J(this,"baseText");this.messages=t,this.tempMessageId=Date.now(),this.dotsUpdateInterval=n,this.baseText=r}start(){this.isAnimating=!0;let t=1;this.messages.update(n=>[...n,{id:this.tempMessageId,text:`${this.baseText} .`,sender:"server",type:"text"}]),this.intervalId=setInterval(()=>{this.isAnimating&&(t=t%3+1,this.messages.update(n=>{const r=n.findIndex(i=>"id"in i&&i.id===this.tempMessageId);return r!==-1&&(n[r]={id:this.tempMessageId,text:`${this.baseText} ${".".repeat(t)}`,sender:"server",type:"text"}),n}))},this.dotsUpdateInterval)}stop(t){this.isAnimating=!1,this.intervalId&&clearInterval(this.intervalId),this.messages.update(n=>{const r=n.findIndex(i=>"id"in i&&i.id===this.tempMessageId);return r!==-1?[...n.slice(0,r),{text:t,sender:"server",type:"text"},...n.slice(r+1)]:n})}getTempMessageId(){return this.tempMessageId}}function ea(e){navigator.clipboard.writeText(e).then(()=>console.log("Copied:",e)).catch(t=>console.error("Error copying:",t))}async function na(e,t,n,r,i){const s=new Li({messages:n,baseText:"  -"});s.start(),await r();try{const o=await Do({text:e,user_id:t,app_name:i}),l=ra(o.audio_data,"audio/mpeg"),c=URL.createObjectURL(l);n.update(u=>{const f=u.findIndex(d=>"id"in d&&d.id===s.getTempMessageId());if(f!==-1){const d=[...u];return d[f]={text:"",sender:"server",type:"audio",audioUrl:c},d}return u}),await Vr(),setTimeout(r,50)}catch(o){console.error("Error in TTS request:",o),s.stop("    "),await r()}}function ra(e,t){try{const n=atob(e),r=[];for(let i=0;i<n.length;i+=512){const s=n.slice(i,i+512),o=new Array(s.length);for(let c=0;c<s.length;c++)o[c]=s.charCodeAt(c);const l=new Uint8Array(o);r.push(l)}return new Blob(r,{type:t})}catch(n){throw console.error("Base64 decoding error:",n),new Error("Invalid base64 string")}}function ia(e){return ta.sanitize(e)}function sa(){const e=la("userId");if(e)return e;const t=oa();return aa("userId",t,365),t}function oa(){return crypto.randomUUID()}function aa(e,t,n){const r=new Date;r.setDate(r.getDate()+n),document.cookie=`${e}=${t}; expires=${r.toUTCString()}; path=/`}function la(e){const t=document.cookie.match(`(^|;)\\s*${e}\\s*=\\s*([^;]+)`);return t?t[2]:null}function ua(){return localStorage.setItem("cookie_consent","true"),!1}function X(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(u){try{c(r.next(u))}catch(f){s(f)}}function l(u){try{c(r.throw(u))}catch(f){s(f)}}function c(u){var f;u.done?i(u.value):(f=u.value,f instanceof n?f:new n(function(d){d(f)})).then(o,l)}c((r=r.apply(e,t||[])).next())})}typeof SuppressedError=="function"&&SuppressedError;class Fe{constructor(){this.listeners={}}on(t,n,r){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(n),r==null?void 0:r.once){const i=()=>{this.un(t,i),this.un(t,n)};return this.on(t,i),i}return()=>this.un(t,n)}un(t,n){var r;(r=this.listeners[t])===null||r===void 0||r.delete(n)}once(t,n){return this.on(t,n,{once:!0})}unAll(){this.listeners={}}emit(t,...n){this.listeners[t]&&this.listeners[t].forEach(r=>r(...n))}}const wn={decode:function(e,t){return X(this,void 0,void 0,function*(){const n=new AudioContext({sampleRate:t});return n.decodeAudioData(e).finally(()=>n.close())})},createBuffer:function(e,t){return typeof e[0]=="number"&&(e=[e]),function(n){const r=n[0];if(r.some(i=>i>1||i<-1)){const i=r.length;let s=0;for(let o=0;o<i;o++){const l=Math.abs(r[o]);l>s&&(s=l)}for(const o of n)for(let l=0;l<i;l++)o[l]/=s}}(e),{duration:t,length:e[0].length,sampleRate:e[0].length/t,numberOfChannels:e.length,getChannelData:n=>e==null?void 0:e[n],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function $i(e,t){const n=t.xmlns?document.createElementNS(t.xmlns,e):document.createElement(e);for(const[r,i]of Object.entries(t))if(r==="children")for(const[s,o]of Object.entries(t))typeof o=="string"?n.appendChild(document.createTextNode(o)):n.appendChild($i(s,o));else r==="style"?Object.assign(n.style,i):r==="textContent"?n.textContent=i:n.setAttribute(r,i.toString());return n}function Pi(e,t,n){const r=$i(e,t||{});return n==null||n.appendChild(r),r}var ca=Object.freeze({__proto__:null,createElement:Pi,default:Pi});const fa={fetchBlob:function(e,t,n){return X(this,void 0,void 0,function*(){const r=yield fetch(e,n);if(r.status>=400)throw new Error(`Failed to fetch ${e}: ${r.status} (${r.statusText})`);return function(i,s){X(this,void 0,void 0,function*(){if(!i.body||!i.headers)return;const o=i.body.getReader(),l=Number(i.headers.get("Content-Length"))||0;let c=0;const u=d=>X(this,void 0,void 0,function*(){c+=(d==null?void 0:d.length)||0;const h=Math.round(c/l*100);s(h)}),f=()=>X(this,void 0,void 0,function*(){let d;try{d=yield o.read()}catch{return}d.done||(u(d.value),yield f())});f()})}(r.clone(),t),r.blob()})}};class ha extends Fe{constructor(t){super(),this.isExternalMedia=!1,t.media?(this.media=t.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),t.mediaControls&&(this.media.controls=!0),t.autoplay&&(this.media.autoplay=!0),t.playbackRate!=null&&this.onMediaEvent("canplay",()=>{t.playbackRate!=null&&(this.media.playbackRate=t.playbackRate)},{once:!0})}onMediaEvent(t,n,r){return this.media.addEventListener(t,n,r),()=>this.media.removeEventListener(t,n,r)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const t=this.getSrc();t.startsWith("blob:")&&URL.revokeObjectURL(t)}canPlayType(t){return this.media.canPlayType(t)!==""}setSrc(t,n){const r=this.getSrc();if(t&&r===t)return;this.revokeSrc();const i=n instanceof Blob&&(this.canPlayType(n.type)||!t)?URL.createObjectURL(n):t;r&&(this.media.src="");try{this.media.src=i}catch{this.media.src=t}}destroy(){this.isExternalMedia||(this.media.pause(),this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}setMediaElement(t){this.media=t}play(){return X(this,void 0,void 0,function*(){return this.media.play()})}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(t){this.media.currentTime=Math.max(0,Math.min(t,this.getDuration()))}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(t){this.media.volume=t}getMuted(){return this.media.muted}setMuted(t){this.media.muted=t}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(t,n){n!=null&&(this.media.preservesPitch=n),this.media.playbackRate=t}getMediaElement(){return this.media}setSinkId(t){return this.media.setSinkId(t)}}class pe extends Fe{constructor(t,n){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.subscriptions=[],this.options=t;const r=this.parentFromOptionsContainer(t.container);this.parent=r;const[i,s]=this.initHtml();r.appendChild(i),this.container=i,this.scrollContainer=s.querySelector(".scroll"),this.wrapper=s.querySelector(".wrapper"),this.canvasWrapper=s.querySelector(".canvases"),this.progressWrapper=s.querySelector(".progress"),this.cursor=s.querySelector(".cursor"),n&&s.appendChild(n),this.initEvents()}parentFromOptionsContainer(t){let n;if(typeof t=="string"?n=document.querySelector(t):t instanceof HTMLElement&&(n=t),!n)throw new Error("Container not found");return n}initEvents(){const t=n=>{const r=this.wrapper.getBoundingClientRect(),i=n.clientX-r.left,s=n.clientY-r.top;return[i/r.width,s/r.height]};if(this.wrapper.addEventListener("click",n=>{const[r,i]=t(n);this.emit("click",r,i)}),this.wrapper.addEventListener("dblclick",n=>{const[r,i]=t(n);this.emit("dblclick",r,i)}),this.options.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{const{scrollLeft:n,scrollWidth:r,clientWidth:i}=this.scrollContainer,s=n/r,o=(n+i)/r;this.emit("scroll",s,o,n,n+i)}),typeof ResizeObserver=="function"){const n=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{n().then(()=>this.onContainerResize()).catch(()=>{})}),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){const t=this.parent.clientWidth;t===this.lastContainerWidth&&this.options.height!=="auto"||(this.lastContainerWidth=t,this.reRender())}initDrag(){this.subscriptions.push(function(t,n,r,i,s=3,o=0,l=100){if(!t)return()=>{};const c=matchMedia("(pointer: coarse)").matches;let u=()=>{};const f=d=>{if(d.button!==o)return;d.preventDefault(),d.stopPropagation();let h=d.clientX,p=d.clientY,m=!1;const C=Date.now(),T=g=>{if(g.preventDefault(),g.stopPropagation(),c&&Date.now()-C<l)return;const D=g.clientX,z=g.clientY,q=D-h,st=z-p;if(m||Math.abs(q)>s||Math.abs(st)>s){const pt=t.getBoundingClientRect(),{left:H,top:Kt}=pt;m||(r==null||r(h-H,p-Kt),m=!0),n(q,st,D-H,z-Kt),h=D,p=z}},b=g=>{if(m){const D=g.clientX,z=g.clientY,q=t.getBoundingClientRect(),{left:st,top:pt}=q;i==null||i(D-st,z-pt)}u()},E=g=>{g.relatedTarget&&g.relatedTarget!==document.documentElement||b(g)},R=g=>{m&&(g.stopPropagation(),g.preventDefault())},w=g=>{m&&g.preventDefault()};document.addEventListener("pointermove",T),document.addEventListener("pointerup",b),document.addEventListener("pointerout",E),document.addEventListener("pointercancel",E),document.addEventListener("touchmove",w,{passive:!1}),document.addEventListener("click",R,{capture:!0}),u=()=>{document.removeEventListener("pointermove",T),document.removeEventListener("pointerup",b),document.removeEventListener("pointerout",E),document.removeEventListener("pointercancel",E),document.removeEventListener("touchmove",w),setTimeout(()=>{document.removeEventListener("click",R,{capture:!0})},10)}};return t.addEventListener("pointerdown",f),()=>{u(),t.removeEventListener("pointerdown",f)}}(this.wrapper,(t,n,r)=>{this.emit("drag",Math.max(0,Math.min(1,r/this.wrapper.getBoundingClientRect().width)))},t=>{this.isDragging=!0,this.emit("dragstart",Math.max(0,Math.min(1,t/this.wrapper.getBoundingClientRect().width)))},t=>{this.isDragging=!1,this.emit("dragend",Math.max(0,Math.min(1,t/this.wrapper.getBoundingClientRect().width)))}))}getHeight(t,n){var r;const i=((r=this.audioData)===null||r===void 0?void 0:r.numberOfChannels)||1;if(t==null)return 128;if(!isNaN(Number(t)))return Number(t);if(t==="auto"){const s=this.parent.clientHeight||128;return n!=null&&n.every(o=>!o.overlay)?s/i:s}return 128}initHtml(){const t=document.createElement("div"),n=t.attachShadow({mode:"open"}),r=this.options.cspNonce&&typeof this.options.cspNonce=="string"?this.options.cspNonce.replace(/"/g,""):"";return n.innerHTML=`
      <style${r?` nonce="${r}"`:""}>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases" part="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[t,n]}setOptions(t){if(this.options.container!==t.container){const n=this.parentFromOptionsContainer(t.container);n.appendChild(this.container),this.parent=n}t.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.options=t,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(t){this.scrollContainer.scrollLeft=t}setScrollPercentage(t){const{scrollWidth:n}=this.scrollContainer,r=n*t;this.setScroll(r)}destroy(){var t,n;this.subscriptions.forEach(r=>r()),this.container.remove(),(t=this.resizeObserver)===null||t===void 0||t.disconnect(),(n=this.unsubscribeOnScroll)===null||n===void 0||n.forEach(r=>r()),this.unsubscribeOnScroll=[]}createDelay(t=10){let n,r;const i=()=>{n&&clearTimeout(n),r&&r()};return this.timeouts.push(i),()=>new Promise((s,o)=>{i(),r=o,n=setTimeout(()=>{n=void 0,r=void 0,s()},t)})}convertColorValues(t){if(!Array.isArray(t))return t||"";if(t.length<2)return t[0]||"";const n=document.createElement("canvas"),r=n.getContext("2d"),i=n.height*(window.devicePixelRatio||1),s=r.createLinearGradient(0,0,0,i),o=1/(t.length-1);return t.forEach((l,c)=>{const u=c*o;s.addColorStop(u,l)}),s}getPixelRatio(){return Math.max(1,window.devicePixelRatio||1)}renderBarWaveform(t,n,r,i){const s=t[0],o=t[1]||t[0],l=s.length,{width:c,height:u}=r.canvas,f=u/2,d=this.getPixelRatio(),h=n.barWidth?n.barWidth*d:1,p=n.barGap?n.barGap*d:n.barWidth?h/2:0,m=n.barRadius||0,C=c/(h+p)/l,T=m&&"roundRect"in r?"roundRect":"rect";r.beginPath();let b=0,E=0,R=0;for(let w=0;w<=l;w++){const g=Math.round(w*C);if(g>b){const q=Math.round(E*f*i),st=q+Math.round(R*f*i)||1;let pt=f-q;n.barAlign==="top"?pt=0:n.barAlign==="bottom"&&(pt=u-st),r[T](b*(h+p),pt,h,st,m),b=g,E=0,R=0}const D=Math.abs(s[w]||0),z=Math.abs(o[w]||0);D>E&&(E=D),z>R&&(R=z)}r.fill(),r.closePath()}renderLineWaveform(t,n,r,i){const s=o=>{const l=t[o]||t[0],c=l.length,{height:u}=r.canvas,f=u/2,d=r.canvas.width/c;r.moveTo(0,f);let h=0,p=0;for(let m=0;m<=c;m++){const C=Math.round(m*d);if(C>h){const b=f+(Math.round(p*f*i)||1)*(o===0?-1:1);r.lineTo(h,b),h=C,p=0}const T=Math.abs(l[m]||0);T>p&&(p=T)}r.lineTo(h,f)};r.beginPath(),s(0),s(1),r.fill(),r.closePath()}renderWaveform(t,n,r){if(r.fillStyle=this.convertColorValues(n.waveColor),n.renderFunction)return void n.renderFunction(t,r);let i=n.barHeight||1;if(n.normalize){const s=Array.from(t[0]).reduce((o,l)=>Math.max(o,Math.abs(l)),0);i=s?1/s:1}n.barWidth||n.barGap||n.barAlign?this.renderBarWaveform(t,n,r,i):this.renderLineWaveform(t,n,r,i)}renderSingleCanvas(t,n,r,i,s,o,l){const c=this.getPixelRatio(),u=document.createElement("canvas");u.width=Math.round(r*c),u.height=Math.round(i*c),u.style.width=`${r}px`,u.style.height=`${i}px`,u.style.left=`${Math.round(s)}px`,o.appendChild(u);const f=u.getContext("2d");if(this.renderWaveform(t,n,f),u.width>0&&u.height>0){const d=u.cloneNode(),h=d.getContext("2d");h.drawImage(u,0,0),h.globalCompositeOperation="source-in",h.fillStyle=this.convertColorValues(n.progressColor),h.fillRect(0,0,u.width,u.height),l.appendChild(d)}}renderMultiCanvas(t,n,r,i,s,o){const l=this.getPixelRatio(),{clientWidth:c}=this.scrollContainer,u=r/l;let f=Math.min(pe.MAX_CANVAS_WIDTH,c,u),d={};if(f===0)return;if(n.barWidth||n.barGap){const T=n.barWidth||.5,b=T+(n.barGap||T/2);f%b!=0&&(f=Math.floor(f/b)*b)}const h=T=>{if(T<0||T>=p||d[T])return;d[T]=!0;const b=T*f,E=Math.min(u-b,f);if(E<=0)return;const R=t.map(w=>{const g=Math.floor(b/u*w.length),D=Math.floor((b+E)/u*w.length);return w.slice(g,D)});this.renderSingleCanvas(R,n,E,i,b,s,o)},p=Math.ceil(u/f);if(!this.isScrollable){for(let T=0;T<p;T++)h(T);return}const m=this.scrollContainer.scrollLeft/u,C=Math.floor(m*p);if(h(C-1),h(C),h(C+1),p>1){const T=this.on("scroll",()=>{const{scrollLeft:b}=this.scrollContainer,E=Math.floor(b/u*p);Object.keys(d).length>pe.MAX_NODES&&(s.innerHTML="",o.innerHTML="",d={}),h(E-1),h(E),h(E+1)});this.unsubscribeOnScroll.push(T)}}renderChannel(t,n,r,i){var{overlay:s}=n,o=function(f,d){var h={};for(var p in f)Object.prototype.hasOwnProperty.call(f,p)&&d.indexOf(p)<0&&(h[p]=f[p]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function"){var m=0;for(p=Object.getOwnPropertySymbols(f);m<p.length;m++)d.indexOf(p[m])<0&&Object.prototype.propertyIsEnumerable.call(f,p[m])&&(h[p[m]]=f[p[m]])}return h}(n,["overlay"]);const l=document.createElement("div"),c=this.getHeight(o.height,o.splitChannels);l.style.height=`${c}px`,s&&i>0&&(l.style.marginTop=`-${c}px`),this.canvasWrapper.style.minHeight=`${c}px`,this.canvasWrapper.appendChild(l);const u=l.cloneNode();this.progressWrapper.appendChild(u),this.renderMultiCanvas(t,o,r,c,l,u)}render(t){return X(this,void 0,void 0,function*(){var n;this.timeouts.forEach(c=>c()),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.options.width!=null&&(this.scrollContainer.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width);const r=this.getPixelRatio(),i=this.scrollContainer.clientWidth,s=Math.ceil(t.duration*(this.options.minPxPerSec||0));this.isScrollable=s>i;const o=this.options.fillParent&&!this.isScrollable,l=(o?i:s)*r;if(this.wrapper.style.width=o?"100%":`${s}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=t,this.emit("render"),this.options.splitChannels)for(let c=0;c<t.numberOfChannels;c++){const u=Object.assign(Object.assign({},this.options),(n=this.options.splitChannels)===null||n===void 0?void 0:n[c]);this.renderChannel([t.getChannelData(c)],u,l,c)}else{const c=[t.getChannelData(0)];t.numberOfChannels>1&&c.push(t.getChannelData(1)),this.renderChannel(c,this.options,l,0)}Promise.resolve().then(()=>this.emit("rendered"))})}reRender(){if(this.unsubscribeOnScroll.forEach(r=>r()),this.unsubscribeOnScroll=[],!this.audioData)return;const{scrollWidth:t}=this.scrollContainer,{right:n}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&t!==this.scrollContainer.scrollWidth){const{right:r}=this.progressWrapper.getBoundingClientRect();let i=r-n;i*=2,i=i<0?Math.floor(i):Math.ceil(i),i/=2,this.scrollContainer.scrollLeft+=i}}zoom(t){this.options.minPxPerSec=t,this.reRender()}scrollIntoView(t,n=!1){const{scrollLeft:r,scrollWidth:i,clientWidth:s}=this.scrollContainer,o=t*i,l=r,c=r+s,u=s/2;if(this.isDragging)o+30>c?this.scrollContainer.scrollLeft+=30:o-30<l&&(this.scrollContainer.scrollLeft-=30);else{(o<l||o>c)&&(this.scrollContainer.scrollLeft=o-(this.options.autoCenter?u:0));const f=o-r-u;n&&this.options.autoCenter&&f>0&&(this.scrollContainer.scrollLeft+=Math.min(f,10))}{const f=this.scrollContainer.scrollLeft,d=f/i,h=(f+s)/i;this.emit("scroll",d,h,f,f+s)}}renderProgress(t,n){if(isNaN(t))return;const r=100*t;this.canvasWrapper.style.clipPath=`polygon(${r}% 0, 100% 0, 100% 100%, ${r}% 100%)`,this.progressWrapper.style.width=`${r}%`,this.cursor.style.left=`${r}%`,this.cursor.style.transform=`translateX(-${Math.round(r)===100?this.options.cursorWidth:0}px)`,this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(t,n)}exportImage(t,n,r){return X(this,void 0,void 0,function*(){const i=this.canvasWrapper.querySelectorAll("canvas");if(!i.length)throw new Error("No waveform data");if(r==="dataURL"){const s=Array.from(i).map(o=>o.toDataURL(t,n));return Promise.resolve(s)}return Promise.all(Array.from(i).map(s=>new Promise((o,l)=>{s.toBlob(c=>{c?o(c):l(new Error("Could not export image"))},t,n)})))})}}pe.MAX_CANVAS_WIDTH=8e3,pe.MAX_NODES=10;class da extends Fe{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}class ar extends Fe{constructor(t=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=t,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return X(this,void 0,void 0,function*(){})}get src(){return this.currentSrc}set src(t){if(this.currentSrc=t,this._duration=void 0,!t)return this.buffer=null,void this.emit("emptied");fetch(t).then(n=>{if(n.status>=400)throw new Error(`Failed to fetch ${t}: ${n.status} (${n.statusText})`);return n.arrayBuffer()}).then(n=>this.currentSrc!==t?null:this.audioContext.decodeAudioData(n)).then(n=>{this.currentSrc===t&&(this.buffer=n,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())})}_play(){var t;if(!this.paused)return;this.paused=!1,(t=this.bufferNode)===null||t===void 0||t.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let n=this.playedDuration*this._playbackRate;(n>=this.duration||n<0)&&(n=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,n),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var t;this.paused=!0,(t=this.bufferNode)===null||t===void 0||t.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return X(this,void 0,void 0,function*(){this.paused&&(this._play(),this.emit("play"))})}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(t){var n,r;const i=t-this.currentTime;(n=this.bufferNode)===null||n===void 0||n.stop(this.audioContext.currentTime+i),(r=this.bufferNode)===null||r===void 0||r.addEventListener("ended",()=>{this.bufferNode=null,this.pause()},{once:!0})}setSinkId(t){return X(this,void 0,void 0,function*(){return this.audioContext.setSinkId(t)})}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this.bufferNode&&(this.bufferNode.playbackRate.value=t)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(t){const n=!this.paused;n&&this._pause(),this.playedDuration=t/this._playbackRate,n&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var t,n;return(t=this._duration)!==null&&t!==void 0?t:((n=this.buffer)===null||n===void 0?void 0:n.duration)||0}set duration(t){this._duration=t}get volume(){return this.gainNode.gain.value}set volume(t){this.gainNode.gain.value=t,this.emit("volumechange")}get muted(){return this._muted}set muted(t){this._muted!==t&&(this._muted=t,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(t){return/^(audio|video)\//.test(t)}getGainNode(){return this.gainNode}getChannelData(){const t=[];if(!this.buffer)return t;const n=this.buffer.numberOfChannels;for(let r=0;r<n;r++)t.push(this.buffer.getChannelData(r));return t}}const pa={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class We extends ha{static create(t){return new We(t)}constructor(t){const n=t.media||(t.backend==="WebAudio"?new ar:void 0);super({media:n,mediaControls:t.mediaControls,autoplay:t.autoplay,playbackRate:t.audioRate}),this.plugins=[],this.decodedData=null,this.stopAtPosition=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},pa,t),this.timer=new da;const r=n?void 0:this.getMediaElement();this.renderer=new pe(this.options,r),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const i=this.options.url||this.getSrc()||"";Promise.resolve().then(()=>{this.emit("init");const{peaks:s,duration:o}=this.options;(i||s&&o)&&this.load(i,s,o).catch(()=>null)})}updateProgress(t=this.getCurrentTime()){return this.renderer.renderProgress(t/this.getDuration(),this.isPlaying()),t}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{if(!this.isSeeking()){const t=this.updateProgress();this.emit("timeupdate",t),this.emit("audioprocess",t),this.stopAtPosition!=null&&this.isPlaying()&&t>=this.stopAtPosition&&this.pause()}}))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",()=>{const t=this.updateProgress();this.emit("timeupdate",t)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("emptied",()=>{this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("ended",()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish"),this.stopAtPosition=null}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}),this.onMediaEvent("error",()=>{var t;this.emit("error",(t=this.getMediaElement().error)!==null&&t!==void 0?t:new Error("Media error")),this.stopAtPosition=null}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(t,n)=>{this.options.interact&&(this.seekTo(t),this.emit("interaction",t*this.getDuration()),this.emit("click",t,n))}),this.renderer.on("dblclick",(t,n)=>{this.emit("dblclick",t,n)}),this.renderer.on("scroll",(t,n,r,i)=>{const s=this.getDuration();this.emit("scroll",t*s,n*s,r,i)}),this.renderer.on("render",()=>{this.emit("redraw")}),this.renderer.on("rendered",()=>{this.emit("redrawcomplete")}),this.renderer.on("dragstart",t=>{this.emit("dragstart",t)}),this.renderer.on("dragend",t=>{this.emit("dragend",t)}));{let t;this.subscriptions.push(this.renderer.on("drag",n=>{if(!this.options.interact)return;let r;this.renderer.renderProgress(n),clearTimeout(t),this.isPlaying()?r=0:this.options.dragToSeek===!0?r=200:typeof this.options.dragToSeek=="object"&&this.options.dragToSeek!==void 0&&(r=this.options.dragToSeek.debounceTime),t=setTimeout(()=>{this.seekTo(n)},r),this.emit("interaction",n*this.getDuration()),this.emit("drag",n)}))}}initPlugins(){var t;!((t=this.options.plugins)===null||t===void 0)&&t.length&&this.options.plugins.forEach(n=>{this.registerPlugin(n)})}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach(t=>t()),this.mediaSubscriptions=[]}setOptions(t){this.options=Object.assign({},this.options,t),t.duration&&!t.peaks&&(this.decodedData=wn.createBuffer(this.exportPeaks(),t.duration)),t.peaks&&t.duration&&(this.decodedData=wn.createBuffer(t.peaks,t.duration)),this.renderer.setOptions(this.options),t.audioRate&&this.setPlaybackRate(t.audioRate),t.mediaControls!=null&&(this.getMediaElement().controls=t.mediaControls)}registerPlugin(t){return t._init(this),this.plugins.push(t),this.subscriptions.push(t.once("destroy",()=>{this.plugins=this.plugins.filter(n=>n!==t)})),t}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(t){return this.renderer.setScroll(t)}setScrollTime(t){const n=t/this.getDuration();this.renderer.setScrollPercentage(n)}getActivePlugins(){return this.plugins}loadAudio(t,n,r,i){return X(this,void 0,void 0,function*(){var s;if(this.emit("load",t),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,this.stopAtPosition=null,!n&&!r){const l=this.options.fetchParams||{};window.AbortController&&!l.signal&&(this.abortController=new AbortController,l.signal=(s=this.abortController)===null||s===void 0?void 0:s.signal);const c=f=>this.emit("loading",f);n=yield fa.fetchBlob(t,c,l);const u=this.options.blobMimeType;u&&(n=new Blob([n],{type:u}))}this.setSrc(t,n);const o=yield new Promise(l=>{const c=i||this.getDuration();c?l(c):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",()=>l(this.getDuration()),{once:!0}))});if(!t&&!n){const l=this.getMediaElement();l instanceof ar&&(l.duration=o)}if(r)this.decodedData=wn.createBuffer(r,o||0);else if(n){const l=yield n.arrayBuffer();this.decodedData=yield wn.decode(l,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())})}load(t,n,r){return X(this,void 0,void 0,function*(){try{return yield this.loadAudio(t,void 0,n,r)}catch(i){throw this.emit("error",i),i}})}loadBlob(t,n,r){return X(this,void 0,void 0,function*(){try{return yield this.loadAudio("",t,n,r)}catch(i){throw this.emit("error",i),i}})}zoom(t){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(t),this.emit("zoom",t)}getDecodedData(){return this.decodedData}exportPeaks({channels:t=2,maxLength:n=8e3,precision:r=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const i=Math.min(t,this.decodedData.numberOfChannels),s=[];for(let o=0;o<i;o++){const l=this.decodedData.getChannelData(o),c=[],u=l.length/n;for(let f=0;f<n;f++){const d=l.slice(Math.floor(f*u),Math.ceil((f+1)*u));let h=0;for(let p=0;p<d.length;p++){const m=d[p];Math.abs(m)>Math.abs(h)&&(h=m)}c.push(Math.round(h*r)/r)}s.push(c)}return s}getDuration(){let t=super.getDuration()||0;return t!==0&&t!==1/0||!this.decodedData||(t=this.decodedData.duration),t}toggleInteraction(t){this.options.interact=t}setTime(t){this.stopAtPosition=null,super.setTime(t),this.updateProgress(t),this.emit("timeupdate",t)}seekTo(t){const n=this.getDuration()*t;this.setTime(n)}play(t,n){const r=Object.create(null,{play:{get:()=>super.play}});return X(this,void 0,void 0,function*(){return t!=null&&this.setTime(t),n!=null&&(this.media instanceof ar?this.media.stopAt(n):this.stopAtPosition=n),r.play.call(this)})}playPause(){return X(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(t){this.setTime(this.getCurrentTime()+t)}empty(){this.load("",[[0]],.001)}setMediaElement(t){this.unsubscribePlayerEvents(),super.setMediaElement(t),this.initPlayerEvents()}exportImage(){return X(this,arguments,void 0,function*(t="image/png",n=1,r="dataURL"){return this.renderer.exportImage(t,n,r)})}destroy(){var t;this.emit("destroy"),(t=this.abortController)===null||t===void 0||t.abort(),this.plugins.forEach(n=>n.destroy()),this.subscriptions.forEach(n=>n()),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}We.BasePlugin=class extends Fe{constructor(e){super(),this.subscriptions=[],this.options=e}onInit(){}_init(e){this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e())}},We.dom=ca;var ma=te("<p><!></p>"),va=te('<div class="audio-message"><div class="wavesurfer-container"><div class="wave"></div></div></div>'),_a=te('<div class="message-actions"><button class="copy-btn" aria-label="Copy" title="Copy message"><img alt="Copy"></button> <button class="speak-btn" aria-label="Voice message" title="Voice message"><img alt="Speak"></button></div>'),ga=te('<div><div class="message-container"><div class="message"><!></div> <!></div></div>'),ba=te('<div class="mic-notice"><p><br>,  <br>   <br> </p></div>'),ya=te('<div class="cookie-notice"><p>   cookie    <br>  ,      cookie</p> <button>Ok</button></div>'),Ea=te('<div class="chat-box"><div class="header-banner-container"></div> <div class="messages-container"></div> <div class="bottom-row"><button class="mic-btn"><img alt="Voice Message"></button> <input type="text" placeholder="Type your message here..." class="input-field"> <button class="send-btn"><img alt="Send"></button></div> <div class="basement"><img alt="Chat Basement Logo" class="basement-logo"></div> <!></div> <!>',1);function Ii(e,t){ri(t,!1);const[n,r]=So(),i=()=>wo(l,"$messages",n);let s=gi(t,"app_name",12,"blacksmith_web"),o=gi(t,"basePath",12,"/blacksmith_web/chat_component_res");const l=Eo([]);let c=Ce(""),u=Ce(),f=Ce(),d=Ce(!0),h=Ce(!1);bo(async()=>{console.log("basePath:",o()),window.location.hostname!=="0xthecableguy.github.io"&&(o("https://0xthecableguy.github.io/blacksmith_web/chat_component_res"),console.log("Using absolute path for resources:",o())),G(f,sa()),console.log("User ID:",S(f)),localStorage.getItem("cookie_consent")==="true"&&G(d,!1);try{const B=await Oo(S(f),s());l.set(B.map(P=>({text:P.message,sender:P.sender,type:"text"}))),await m()}catch(B){console.error("Error fetching chat history:",B)}});async function p(){if(!S(c).trim())return;l.update(B=>[...B,{text:S(c),sender:"user",type:"text"}]),await m();const $=S(c);G(c,"");const I=new Li({messages:l});I.start(),await m();try{const B=await Mo({text:$,user_id:S(f),app_name:s()});I.stop(B.text),await m()}catch(B){console.error("Error sending request to server:",B),I.stop("    . ,  ")}}async function m(){await Vr(),S(u)&&S(u).scrollTo({top:S(u).scrollHeight,behavior:"smooth"})}function C(){G(d,ua())}function T($,I){if(!I)return;const B={container:$,waveColor:"#6578fe",progressColor:"#bec5fc",cursorColor:"#d5deff",backgroundColor:"#d5deff",mediaControls:!0,height:64,interact:!0,dragToSeek:!1,hideScrollbar:!1,autoScroll:!0,autoCenter:!0,normalize:!0,fillParent:!0},P=We.create(B);return P.load(I),P}function b(){G(h,!0),setTimeout(()=>G(h,!1),3e3)}go();var E=Ea(),R=Wr(E),w=At(lt(R),2);so(w,5,i,ro,($,I)=>{var B=ga(),P=lt(B),me=lt(P),j=lt(me);{var Sn=mt=>{var ut=ma(),St=lt(ut);lo(St,()=>ia(S(I).text)),tt(ut),It(mt,ut)},W=mt=>{var ut=to(),St=Wr(ut);{var ve=ct=>{var Ft=va(),Wt=lt(Ft);uo(Wt,(Ge,je)=>T==null?void 0:T(Ge,je),()=>S(I).audioUrl),tt(Ft),It(ct,Ft)};Ne(St,ct=>{S(I).type==="audio"&&ct(ve)},!0)}It(mt,ut)};Ne(j,mt=>{S(I).type==="text"?mt(Sn):mt(W,!1)})}tt(me);var re=At(me,2);{var ze=mt=>{var ut=_a(),St=lt(ut),ve=lt(St);tt(St);var ct=At(St,2),Ft=lt(ct);tt(ct),tt(ut),Vn(()=>{ee(ve,"src",`${o()??""}/copy_icon.png`),ee(Ft,"src",`${o()??""}/speak_icon.png`)}),fe("click",St,()=>ea(S(I).text)),fe("click",ct,()=>na(S(I).text,S(f),l,m,s())),It(mt,ut)};Ne(re,mt=>{S(I).sender==="server"&&S(I).type==="text"&&mt(ze)})}tt(P),tt(B),Vn(()=>fo(B,1,`message-wrapper ${(S(I).sender==="user"?"user-message":"server-message")??""}`)),It($,B)}),tt(w),_o(w,$=>G(u,$),()=>S(u));var g=At(w,2),D=lt(g),z=lt(D);tt(D);var q=At(D,2);ho(q);var st=At(q,2),pt=lt(st);tt(st),tt(g);var H=At(g,2),Kt=lt(H);tt(H);var He=At(H,2);{var Be=$=>{var I=ba();It($,I)};Ne(He,$=>{S(h)&&$(Be)})}tt(R);var lr=At(R,2);{var ur=$=>{var I=ya(),B=At(lt(I),2);tt(I),fe("click",B,C),It($,I)};Ne(lr,$=>{S(d)&&$(ur)})}Vn(()=>{ee(z,"src",`${o()??""}/mic_icon.png`),ee(pt,"src",`${o()??""}/mini_logo.png`),ee(Kt,"src",`${o()??""}/logo_black.png`)}),fe("click",D,b),mo(q,()=>S(c),$=>G(c,$)),fe("keydown",q,$=>$.key==="Enter"&&p()),fe("click",st,p),It(e,E),vo(t,"scrollToBottom",m);var cr=ii({scrollToBottom:m,get app_name(){return s()},set app_name($){s($),dn()},get basePath(){return o()},set basePath($){o($),dn()}});return r(),cr}return customElements.define("blacksmithlab-chat-ui",ko(Ii,{app_name:{},basePath:{}},[],["scrollToBottom"],!0)),Ii});
